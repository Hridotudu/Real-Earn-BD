আপনার দেওয়া সম্পূর্ণ কোডটি ইংরেজিতে নিচে দেওয়া হলো:
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>❤️Hridoy Skill❤️</title>
  <style>
    /* Global Variables for Colors (Dark/Light Mode) */
    :root {
      --bg-color: #f0f2f5;
      --text-color: #000;
      --card-bg: #fff;
      --header-bg: linear-gradient(90deg, #007bff, #00c6ff);
      --button-bg: linear-gradient(45deg, #007bff, #00c6ff);
      --link-color: #007bff;
      --modal-bg: rgba(0, 0, 0, 0.7); /* Modal overlay background */
      --modal-content-bg: #fff;
    }
    /* Dark Mode Styles */
    body.dark {
      --bg-color: #121212;
      --text-color: #fff;
      --card-bg: #1e1e1e;
      --header-bg: linear-gradient(90deg, #333, #555);
      --button-bg: linear-gradient(45deg, #444, #777);
      --link-color: #00c6ff;
      --modal-content-bg: #2a2a2a;
    }

    /* Base Body Styles */
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding-bottom: 80px; /* Space for fixed navigation bar */
      transition: background 0.3s, color 0.3s; /* Smooth transition for dark/light mode */
      -webkit-font-smoothing: antialiased; /* Better font rendering on mobile */
      -moz-osx-font-smoothing: grayscale;
    }

    /* Header Styles */
    header {
      background: var(--header-bg);
      color: white;
      padding: 15px; /* Slightly reduced padding for mobile */
      text-align: center;
      font-size: 18px; /* Slightly reduced font size for mobile */
      font-weight: bold;
      position: relative;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Added subtle shadow for depth */
    }

    /* Dark Mode Toggle Button */
    .toggle-mode {
      position: absolute;
      top: 12px;
      right: 15px; /* Adjusted right spacing */
      font-size: 13px; /* Slightly smaller font */
      background: #fff3; /* Semi-transparent white */
      padding: 6px 10px; /* Adjusted padding */
      border-radius: 20px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
    }

    /* Main Container for Content */
    .container {
      max-width: 500px; /* Max width for larger screens */
      margin: auto; /* Center the container */
      padding: 15px; /* Reduced overall padding for mobile */
    }

    /* Section Visibility (for tab switching) */
    .section { display: none; }
    .section.active { display: block; } /* Show active section */

    /* Card Styles */
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px; /* Slightly reduced margin between cards */
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); /* Soft shadow for cards */
    }

    /* Button Styles */
    .btn {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      background: var(--button-bg);
      border: none;
      border-radius: 30px; /* Rounded buttons */
      cursor: pointer;
      margin-top: 10px;
      transition: transform 0.2s ease; /* Smooth hover effect */
      -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
    }
    .btn:hover { transform: scale(1.02); } /* Slight scale on hover */
    .btn:active { transform: scale(0.98); } /* Slight scale on active (tap) */

    /* Fixed Navigation Bar */
    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      display: flex;
      justify-content: space-around;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1); /* Shadow above nav */
      display: none; /* Hidden by default, shown after login */
      z-index: 1000; /* Ensure nav is on top of other content */
    }
    nav button {
      flex: 1; /* Equal width for all buttons */
      padding: 12px;
      border: none;
      background: none;
      font-weight: bold;
      color: var(--text-color);
      font-size: 15px; /* Slightly smaller font for nav items */
      -webkit-tap-highlight-color: transparent;
    }
    nav button:active { background: rgba(0,0,0,0.05); } /* Light background on active */

    /* Info/Status Messages */
    .info {
      font-weight: bold;
      color: green;
      margin-top: 10px;
      font-size: 14px; /* Slightly smaller font for info text */
      text-align: center; /* Center align info messages */
    }

    /* Input Field Styles */
    input[type="text"], input[type="file"] {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 15px; /* Slightly smaller font for inputs */
      box-sizing: border-box; /* Ensures padding doesn't increase width */
      background: var(--bg-color); /* Input background adapts to dark/light mode */
      color: var(--text-color); /* Input text color adapts to dark/light mode */
    }
    input[type="file"] {
      padding: 8px; /* Smaller padding for file input */
    }

    /* Username Display in Dashboard */
    #usernameDisplay {
        font-size: 18px;
        font-weight: bold;
        color: var(--link-color); /* Matches header/button gradient start color */
        margin-bottom: 15px;
        text-align: center;
        padding-top: 10px; /* Add some space above the text */
    }
    
    /* Small Screen Adjustments (Optional, but good practice for very small phones) */
    @media (max-width: 320px) {
        header {
            font-size: 16px;
            padding: 12px;
        }
        .toggle-mode {
            font-size: 12px;
            padding: 5px 8px;
        }
        .btn {
            font-size: 14px;
            padding: 12px;
        }
        nav button {
            font-size: 14px;
            padding: 10px;
        }
        .card {
            padding: 15px;
        }
    }

    /* --- Modal Styles --- */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1001; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: var(--modal-bg); /* Black w/ opacity */
      justify-content: center; /* Center content horizontally */
      align-items: center; /* Center content vertically */
    }

    .modal-content {
      background-color: var(--modal-content-bg);
      margin: 15% auto; /* 15% from the top and centered */
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      width: 90%; /* Responsive width */
      max-width: 400px; /* Max width for larger screens */
      text-align: center;
      position: relative; /* For close button positioning */
      color: var(--text-color);
    }

    .close-button {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close-button:hover,
    .close-button:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

    #referralLinkInput {
      width: calc(100% - 20px); /* Adjust for padding */
      padding: 10px;
      margin: 15px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      background: var(--bg-color);
      color: var(--text-color);
      text-align: center;
      cursor: text; /* Allow selection */
    }

    .copy-btn {
      background: linear-gradient(45deg, #28a745, #218838); /* Green gradient for copy button */
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      transition: transform 0.2s ease;
      -webkit-tap-highlight-color: transparent;
      margin-top: 10px;
    }
    .copy-btn:hover { transform: scale(1.02); }
    .copy-btn:active { transform: scale(0.98); }

    /* Flash message for copy confirmation */
    .flash-message {
        position: fixed;
        bottom: 90px; /* Above the nav bar */
        left: 50%;
        transform: translateX(-50%);
        background-color: #28a745; /* Green for success */
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
        z-index: 1002; /* Above modal */
        font-size: 14px;
        white-space: nowrap; /* Prevent text wrapping */
    }
    .flash-message.show {
        opacity: 1;
    }
  </style>
</head>
<body>
<header>
  Developer:Hridoy Skill
  <span class="toggle-mode" onclick="toggleDarkMode()"> ☀️ </span>
</header>

<div class="container">
  <div id="auth" class="section active">
    <div class="card">
      <h3>Welcome!</h3>
      <p>Please enter your name and Telegram User ID to continue.</p>
      <input type="text" id="usernameInput" placeholder="Enter your Name" required>
      <input type="text" id="telegramUidInput" placeholder="Enter your Telegram User ID" required>
      <button class="btn" onclick="registerOrLogin()">Enter Your Name</button>
      <p style="margin-top: 10px; color: #888; text-align: center; font-size: 13px;">If you're new, your account will be created. If you've been here before, you'll be logged in.</p>
    </div>
  </div>

  <div id="appSections" style="display: none;">
    <p id="usernameDisplay"></p>
    <div id="home" class="section">
      <div class="card">
        <h3>Dashboard</h3>
        <p>Balance: <strong id="balance">$0.000</strong></p>
       
        <p>Total Ads Watched: <strong id="adsWatched">0</strong></p>
        <p>Daily Ads Watched: <strong id="dailyAdsWatched">0</strong></p>
        <p>Tasks Completed: <strong id="tasksCompleted">0</strong></p>
        <p>Total Referrals: <strong id="totalReferrals">0</strong></p> 
        
        <img src="https://res.cloudinary.com/dtjjgiitl/image/upload/q_auto:good,f_auto,fl_progressive/v1752401954/w0d4yapthokp30zvta1j.jpg" alt="Meditation Image" style="max-width:100%; height:auto; display:block; margin: 15px auto;">
        <button class="btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <div id="earn" class="section">
      <div class="card">
        <h3>Watch Ads</h3>
        <button class="btn" onclick="watchAd()">Watch Ad & Earn</button>
        <p style="margin-top: 10px; font-weight: bold; text-align: center;">Daily Ads: <strong id="dailyAdsWatchedEarn">0</strong></p>
        <p class="info" id="ad-status">Click the button to watch ad</p>
        <p class="info" id="ad-target-message" style="color:orange;"></p>
      </div>
      <div class="card">
        <h3>Tasks</h3>
        <p style="margin-top: 10px; color: #888; text-align: center; font-size: 13px;">Complete a task, then submit a screenshot below for verification to earn!</p>
        <button class="btn" onclick="taskWithRedirect('https://t.me/Hridoy_Skill')">Join Telegram</button>
        <button class="btn" onclick="taskWithRedirect('https://youtube.com/@hridoy_skill_0.69?si=GfXezqZBlqsXYWVc')">Subscribe YouTube</button>
        <button class="btn" onclick="taskWithRedirect('https://www.facebook.com/Hridoy.tudu.69')">Like Facebook Page</button>
        <button class="btn" onclick="taskWithRedirect('https://instagram.com')">Follow Instagram</button>
        <button class="btn" onclick="taskWithRedirect('https://youtu.be/Nqg8N0_RY_g?si=QFzA-UZbj6YxkIF9')">Share Post</button>
        
        <button class="btn" onclick="showReferralLink()">Refer & Earn</button>

        <hr style="margin-top:20px; border: 0; border-top: 1px solid #eee;">

        <h4>Add Screenshots for Task Completion</h4>
        <input type="text" id="screenshotName" placeholder="Enter Your Name (for verification)">
        <input type="file" id="screenshotUpload" accept="image/*">
        <button class="btn" onclick="submitScreenshot()">Submit Screenshot</button>
        <p class="info" id="screenshot-status"></p>
      </div>
    </div>

    <div id="withdraw" class="section">
      <div class="card">
        <h3>Withdraw</h3>
        <input id="withdrawAmount" type="text" placeholder="Enter Amount">
        <input id="withdrawMethod" type="text" placeholder="Payment Method or Account">
        <button class="btn" onclick="submitWithdraw()">Submit Request</button>
      </div>
    </div>

    <div id="contact" class="section">
      <div class="card">
        <h3>Contact</h3>
        <button class="btn" onclick="window.open('https://t.me/Hridoy_Tudu')">Chat with Admin</button>
        <button class="btn" onclick="window.open('https://t.me/Hridoy_Tudu')">Contact Owner</button>
        <button class="btn" onclick="window.open('https://youtu.be/Nqg8N0_RY_g?si=QFzA-UZbj6YxkIF9')">Watch Help Video</button>
      </div>
    </div>

    <div id="profile" class="section">
      <div class="card">
        <h3>Profile</h3>
        <p>Total Ads: <strong id="adsWatchedProfile">0</strong></p>
        <p>Daily Ads: <strong id="dailyAdsWatchedProfile">0</strong></p>
        <p>Total Tasks: <strong id="tasksCompletedProfile">0</strong></p>
        <p>Total Withdraw: <strong id="withdrawTotal">$0.00</strong></p>
        <p>Total Referrals: <strong id="totalReferralsProfile">0</strong></p> 
        <p style="margin-top:10px;color:#888;">❤️Developer:Hridoy Skill❤️</p>
        <img src="https://res.cloudinary.com/dtjjgiitl/image/upload/q_auto:good,f_auto,fl_progressive/v1752401954/w0d4yapthokp30zvta1j.jpg" alt="Meditation Image" style="max-width:100%; height:auto; display:block; margin: 15px auto;">
      </div>
    </div>
  </div> </div>

<nav>
  <button onclick="showTab('home')">Home</button>
  <button onclick="showTab('earn')">Earn</button>
  <button onclick="showTab('withdraw')">Withdraw</button>
  <button onclick="showTab('contact')">Contact</button>
  <button onclick="showTab('profile')">Profile</button>
</nav>

<div id="referralModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeReferralModal()">×</span>
    <h3>Your Referral Link</h3>
    <p style="font-size: 14px; color: #888;">Share this link to invite friends and earn!</p>
    <input type="text" id="referralLinkInput" value="" readonly>
    <button class="copy-btn" onclick="copyReferralLink()">Copy Link</button>
    <p id="copyStatus" style="font-size: 13px; color: green; margin-top: 10px;"></p>
  </div>
</div>

<div id="flashMessage" class="flash-message"></div>

<script src="//libtl.com/sdk.js" data-zone="9506403" data-sdk="show_9506403"></script>

<script>
  // Telegram Bot Credentials (Replace with your actual bot token and chat ID)
  const TELEGRAM_BOT_TOKEN = '7310981934:AAE05Bo05CBLadaTWPgZg79fgvHsPuW9s8I';
  const TELEGRAM_CHAT_ID = '5965219037'; // Your Telegram Chat ID to receive messages

  let currentUser = null; // Stores the currently logged-in user's name
  let users = JSON.parse(localStorage.getItem('users')) || {}; // Stores all user data from localStorage

  // Add a new variable to store the potential referrer ID
  let referrerId = null;

  // --- Add this function to parse URL parameters ---
  function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      var results = regex.exec(location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
  }

  /**
   * Saves the current user's data to the global 'users' object and then to localStorage.
   */
  function saveUserData() {
    if (currentUser && users[currentUser]) { // Ensure currentUser and its data exist
      // Update data for the current user
      users[currentUser] = {
        balance: parseFloat(document.getElementById('balance').innerText.replace('$', '')),
        adsWatched: parseInt(document.getElementById('adsWatched').innerText),
        dailyAdsWatched: parseInt(document.getElementById('dailyAdsWatched').innerText),
        lastAdResetDate: users[currentUser].lastAdResetDate || new Date().toISOString(), // Fallback if not set
        tasksCompleted: parseInt(document.getElementById('tasksCompleted').innerText),
        totalWithdraw: parseFloat(document.getElementById('withdrawTotal').innerText.replace('$', '')),
        totalReferrals: parseInt(document.getElementById('totalReferrals').innerText), // Added totalReferrals
        referredUsers: users[currentUser].referredUsers || [], // Store actual referred user names
        telegramUid: users[currentUser].telegramUid // Ensure Telegram UID is saved
      };
    }
    // Save the entire users object to localStorage
    localStorage.setItem('users', JSON.stringify(users));
  }

  /**
   * Loads a specific user's data from the 'users' object and updates the UI.
   * If the user is new, initializes with default values.
   * @param {string} username - The username to load data for.
   */
  function loadUserData(username) {
    if (users[username]) {
      const userData = users[username];
      document.getElementById("balance").innerText = `$${userData.balance.toFixed(3)}`;
      document.getElementById("adsWatched").innerText = userData.adsWatched;
      document.getElementById("tasksCompleted").innerText = userData.tasksCompleted;
      document.getElementById("withdrawTotal").innerText = `$${userData.totalWithdraw.toFixed(3)}`;
      document.getElementById("totalReferrals").innerText = userData.totalReferrals || 0; // Load total referrals
      
      // Handle daily ad reset
      const now = new Date().getTime();
      const lastReset = userData.lastAdResetDate ? new Date(userData.lastAdResetDate).getTime() : 0;
      const twentyFourHours = 24 * 60 * 60 * 1000;

      if (now - lastReset >= twentyFourHours) {
        users[username].dailyAdsWatched = 0;
        users[username].lastAdResetDate = new Date().toISOString(); // Set new reset date
      }
      document.getElementById("dailyAdsWatched").innerText = users[username].dailyAdsWatched;
      document.getElementById("dailyAdsWatchedEarn").innerText = users[username].dailyAdsWatched; // Update for earn section

    } else {
      // Initialize new user with default values (This block is now mostly redundant
      // as new user initialization happens directly in registerOrLogin,
      // but kept for robustness if logic changes)
      document.getElementById("balance").innerText = `$0.000`;
      document.getElementById("adsWatched").innerText = 0;
      document.getElementById("dailyAdsWatched").innerText = 0;
      document.getElementById("dailyAdsWatchedEarn").innerText = 0;
      document.getElementById("tasksCompleted").innerText = 0;
      document.getElementById("withdrawTotal").innerText = `$0.000`;
      document.getElementById("totalReferrals").innerText = 0;
    }
    updateProfileStats(); // Also update the profile section's display
  }

  /**
   * Handles user registration or login based on the entered username and Telegram UID.
   */
  function registerOrLogin() {
    const usernameInput = document.getElementById('usernameInput').value.trim();
    const telegramUidInput = document.getElementById('telegramUidInput').value.trim(); // Get Telegram UID

    if (usernameInput === "" || telegramUidInput === "") {
      alert("Please enter both your Name and Telegram User ID to proceed.");
      return;
    }

    currentUser = usernameInput;
    localStorage.setItem('loggedInUser', currentUser); // Store currently logged-in user for session persistence

    // Check if the user is new
    if (!users[currentUser]) {
      // This is a NEW user registration
      users[currentUser] = {
        balance: 0.000,
        adsWatched: 0,
        dailyAdsWatched: 0,
        lastAdResetDate: new Date().toISOString(),
        tasksCompleted: 0,
        totalWithdraw: 0.000,
        totalReferrals: 0,
        referredUsers: [],
        telegramUid: telegramUidInput // Store the Telegram UID for new users
      };

      // If there's a referrer ID, assign it and award bonus
      if (referrerId && referrerId !== currentUser && users[referrerId]) { // Ensure referrer exists and not self-referring
        users[currentUser].referredBy = referrerId; // Track who referred this new user
        users[referrerId].balance += 0.020; // Example: Referrer gets $0.020
        users[referrerId].totalReferrals++; // Increment referrer's total referrals
        users[referrerId].referredUsers.push(currentUser); // Add new user to referrer's list
        
        showFlashMessage(`Welcome, ${currentUser}! A referral bonus has been added to ${referrerId}'s account.`);
        sendTelegramMessage(`New user registered: ${currentUser}\nReferred by: ${referrerId}\nReferral bonus paid to ${referrerId}`);
      }
      saveUserData(); // Save the newly created user data immediately
    } else {
      // Existing user logging in
      // NEW: Validate Telegram UID for existing users
      if (users[currentUser].telegramUid !== telegramUidInput) {
        alert("Incorrect Telegram User ID for this username. Please try again.");
        currentUser = null; // Prevent login if UID is wrong
        localStorage.removeItem('loggedInUser');
        return; // Stop the login process
      }
      console.log(`${currentUser} logged in.`);
    }

    loadUserData(currentUser); // Load user-specific data into the UI
    document.getElementById('usernameDisplay').innerText = `Welcome, ${currentUser}!`; // Display welcome message
    document.getElementById('auth').style.display = 'none'; // Hide the login/registration section
    document.getElementById('appSections').style.display = 'block'; // Show the main application content
    document.querySelector('nav').style.display = 'flex'; // Show the navigation bar
    showTab('home'); // Automatically navigate to the Dashboard tab
  }

  /**
   * Logs out the current user, saves their data, and returns to the login screen.
   */
  function logout() {
    if (confirm("Are you sure you want to log out?")) {
      saveUserData(); // Save current user's data before logging out
      currentUser = null; // Clear current user
      localStorage.removeItem('loggedInUser'); // Remove logged-in user from localStorage
      document.getElementById('auth').style.display = 'block'; // Show login/registration section
      document.getElementById('appSections').style.display = 'none'; // Hide main application content
      document.querySelector('nav').style.display = 'none'; // Hide navigation bar
      document.getElementById('usernameInput').value = ''; // Clear username input field
      document.getElementById('telegramUidInput').value = ''; // Clear Telegram UID input field
      showFlashMessage("You have been logged out successfully.");
    }
  }

  /**
   * Checks if a user was previously logged in on page load and restores the session.
   */
  function checkLoginStatus() {
    // Capture referrer ID from URL on initial load BEFORE login check
    referrerId = getUrlParameter('ref');
    if (referrerId) {
        console.log(`Potential referrer ID found in URL: ${referrerId}`);
        sessionStorage.setItem('tempReferrerId', referrerId);
    } else {
        referrerId = sessionStorage.getItem('tempReferrerId');
    }

    const loggedInUser = localStorage.getItem('loggedInUser');
    if (loggedInUser) {
      currentUser = loggedInUser;
      loadUserData(currentUser);
      document.getElementById('usernameDisplay').innerText = `Welcome, ${currentUser}!`;
      document.getElementById('auth').style.display = 'none';
      document.getElementById('appSections').style.display = 'block';
      document.querySelector('nav').style.display = 'flex';
      showTab('home'); // Go to dashboard if already logged in
    } else {
      document.getElementById('auth').style.display = 'block';
      document.getElementById('appSections').style.display = 'none';
      document.querySelector('nav').style.display = 'none';
    }
  }

  /**
   * Shows the selected tab and hides others.
   * @param {string} tabId - The ID of the tab to show (e.g., 'home', 'earn').
   */
  function showTab(tabId) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    // Ensure the app sections are visible before showing a specific tab
    if (document.getElementById('appSections').style.display === 'block') {
      document.getElementById(tabId).classList.add('active');
    }
    updateProfileStats(); // Always update profile stats when changing tabs
  }

  /**
   * Simulates watching an ad and awards balance.
   * Integrates with an external ad SDK.
   */
  function watchAd() {
    const status = document.getElementById("ad-status");
    const adTargetMessage = document.getElementById("ad-target-message");

    // Check if the external ad SDK function is available
    if (typeof show_9506403 === "function") {
      show_9506403(); // Call the external ad display function
    } else {
      showFlashMessage("Ads not loaded. Please ensure you have an active internet connection or try refreshing the page.");
      return;
    }

    if (users[currentUser].dailyAdsWatched >= 100) {
      status.innerText = "Your daily ad limit is reached. Please try again tomorrow.";
      adTargetMessage.innerText = `You have watched ${users[currentUser].dailyAdsWatched} ads for today.`;
      return;
    }

    let sec = 15; // Ad watch duration
    status.innerText = `Please watch... ${sec}s`;
    let timer = setInterval(() => {
      sec--;
      if (sec > 0) {
        status.innerText = `Please watch... ${sec}s`;
      } else {
        clearInterval(timer);
        users[currentUser].balance += 0.005; // Award earnings
        users[currentUser].adsWatched++; // Increment total ad count
        users[currentUser].dailyAdsWatched++; // Increment daily ad count
        users[currentUser].lastAdResetDate = new Date().toISOString(); // Update last ad watch time for daily reset
        updateStatsDisplay(); // Update UI display
        status.innerText = `Earned $0.005!`;
        saveUserData(); // Save updated user data

        if (users[currentUser].dailyAdsWatched < 100) {
            adTargetMessage.innerText = `You can watch ${100 - users[currentUser].dailyAdsWatched} more ads today.`;
        }
      }
    }, 1000);
  }

  /**
   * Handles task completion with a redirect. Money is NOT awarded here.
   * @param {string} url - The URL to redirect the user to for the task.
   */
  function taskWithRedirect(url) {
    // Check if it's a YouTube URL and use the YouTube tool if applicable
    if (url.startsWith('http://googleusercontent.com/youtube.com/')) {
        const videoId = url.split('/').pop();
        console.log(`Attempting to open YouTube video with ID: ${videoId}`);
    }
    window.open(url, '_blank'); // Open URL in a new tab
    showFlashMessage("Task opened. Please complete the task and submit a screenshot for verification to earn!");
  }

  /**
   * Displays the referral modal with the user's unique Telegram referral link.
   */
  function showReferralLink() {
      if (currentUser) {
          const referralLink = `https://t.me/RealEarnBD62_bot?startapp=ref_${currentUser}`;
          document.getElementById('referralLinkInput').value = referralLink;
          document.getElementById('referralModal').style.display = 'flex'; // Show modal
          document.getElementById('copyStatus').innerText = ''; // Clear previous status
      } else {
          showFlashMessage("Please log in first to see the referral link.");
      }
  }

  /**
   * Hides the referral modal.
   */
  function closeReferralModal() {
      document.getElementById('referralModal').style.display = 'none'; // Hide modal
  }

  /**
   * Copies the referral link from the input field to the clipboard.
   */
  function copyReferralLink() {
      const referralLinkInput = document.getElementById('referralLinkInput');
      referralLinkInput.select(); // Select the text in the input field
      referralLinkInput.setSelectionRange(0, 99999); // For mobile devices

      // Copy the text
      navigator.clipboard.writeText(referralLinkInput.value).then(() => {
          document.getElementById('copyStatus').innerText = "Link copied successfully!";
          showFlashMessage("Referral link copied!");
          setTimeout(() => { // Clear status after a short delay
              document.getElementById('copyStatus').innerText = '';
              closeReferralModal(); // Optionally close modal after successful copy
          }, 1500);
      }).catch(err => {
          document.getElementById('copyStatus').innerText = "Failed to copy. Copy manually.";
          showFlashMessage("Failed to copy link!");
          console.error('Failed to copy referral link: ', err);
      });
  }

  /**
   * Handles submitting a screenshot for task verification to Telegram.
   */
  async function submitScreenshot() {
    const userNameInput = document.getElementById("screenshotName").value.trim();
    const screenshotFile = document.getElementById("screenshotUpload").files;
    const screenshotStatus = document.getElementById("screenshot-status");

    if (!userNameInput || screenshotFile.length === 0) {
      showFlashMessage("Please enter your name for verification and select a screenshot image.");
      return;
    }
    // Ensure the name entered matches the logged-in user for verification
    if (userNameInput !== currentUser) {
        showFlashMessage("The name entered for screenshot verification must match your logged-in username.");
        return;
    }

    const formData = new FormData();
    formData.append('chat_id', TELEGRAM_CHAT_ID);
    formData.append('caption', `New task screenshot submitted:\nUser: ${currentUser}\nName on screenshot: ${userNameInput}`);
    formData.append('photo', screenshotFile[0]); // Upload only the first selected file

    screenshotStatus.innerText = "Sending screenshot...";
    try {
      const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
        method: 'POST',
        body: formData
      });

      const result = await response.json();
      if (result.ok) {
        screenshotStatus.innerText = "Screenshot sent successfully! Waiting for verification...";
        showFlashMessage("Screenshot sent!");
        
        // Simulate verification delay
        let sec = 10; // seconds
        let timer = setInterval(() => {
          sec--;
          if (sec > 0) {
            screenshotStatus.innerText = `Verifying... ${sec}s`;
          } else {
            clearInterval(timer);
            users[currentUser].balance += 0.005; // Award earnings after "verification"
            users[currentUser].tasksCompleted++; // Increment task count
            updateStatsDisplay(); // Update UI display
            screenshotStatus.innerText = `Verification complete! $0.005 added to your balance.`;
            showFlashMessage(`Verification complete! $0.005 added to your balance.`);
            // Clear input fields after successful submission and award
            document.getElementById("screenshotName").value = '';
            document.getElementById("screenshotUpload").value = '';
            saveUserData(); // Save updated user data
          }
        }, 1000);

      } else {
        screenshotStatus.innerText = "Failed to send screenshot. Please try again. Error: " + (result.description || "Unknown");
        showFlashMessage("Failed to send screenshot!");
        console.error("Telegram API error:", result);
      }
    } catch (error) {
      console.error("Error submitting screenshot:", error);
      screenshotStatus.innerText = "An error occurred while submitting the screenshot. Please check your internet connection.";
      showFlashMessage("Network error!");
    }
  }

  /**
   * Updates the balance, ads watched, tasks completed, and referrals displays for the current user.
   */
  function updateStatsDisplay() {
    const userData = users[currentUser];
    document.getElementById("balance").innerText = `$${userData.balance.toFixed(3)}`;
    document.getElementById("adsWatched").innerText = userData.adsWatched;
    document.getElementById("dailyAdsWatched").innerText = userData.dailyAdsWatched; // Update daily ads for dashboard
    document.getElementById("dailyAdsWatchedEarn").innerText = userData.dailyAdsWatched; // Update daily ads for earn section
    document.getElementById("tasksCompleted").innerText = userData.tasksCompleted;
    document.getElementById("totalReferrals").innerText = userData.totalReferrals; // Update total referrals
    updateProfileStats(); // Ensure profile section is also updated
  }

  /**
   * Updates the profile tab's specific statistics.
   */
  function updateProfileStats() {
    const userData = users[currentUser];
    document.getElementById("adsWatchedProfile").innerText = userData.adsWatched;
    document.getElementById("dailyAdsWatchedProfile").innerText = userData.dailyAdsWatched; // Update daily ads in profile
    document.getElementById("tasksCompletedProfile").innerText = userData.tasksCompleted;
    document.getElementById("withdrawTotal").innerText = `$${userData.totalWithdraw.toFixed(3)}`;
    document.getElementById("totalReferralsProfile").innerText = userData.totalReferrals; // Update total referrals in profile

    const adTargetMessage = document.getElementById("ad-target-message");
    if (users[currentUser].dailyAdsWatched < 100) {
        adTargetMessage.innerText = `You can watch ${100 - users[currentUser].dailyAdsWatched} more ads today.`;
    } else {
        adTargetMessage.innerText = `You have watched ${users[currentUser].dailyAdsWatched} ads for today.`;
    }
  }

  /**
   * Handles user withdrawal requests, sends details to Telegram, resets balance, and resets referrals.
   */
  async function submitWithdraw() {
    const amount = parseFloat(document.getElementById("withdrawAmount").value);
    const method = document.getElementById("withdrawMethod").value;

    if (!amount || !method || amount > users[currentUser].balance || amount <= 0) {
      showFlashMessage("Please fill all fields correctly, and ensure the amount is valid and less than or equal to your balance.");
      return;
    }

    const message = `New Withdraw Request from user: ${currentUser}\nAmount: $${amount.toFixed(3)}\nPayment Method: ${method}\nBalance Before: $${users[currentUser].balance.toFixed(3)}\nTotal Referrals Before: ${users[currentUser].totalReferrals}`;

    try {
      const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
      });

      const result = await response.json();
      if (result.ok) {
        users[currentUser].balance = 0; // Reset balance after withdrawal request
        users[currentUser].totalWithdraw += amount; // Add to total withdrawn amount
        users[currentUser].totalReferrals = 0; // Reset total referrals after withdrawal
        users[currentUser].referredUsers = []; // Clear the list of referred users
        
        updateStatsDisplay(); // Update UI display
        showFlashMessage("Withdraw request sent successfully! Your balance and referral count have been reset.");
        // Clear withdraw input fields
        document.getElementById("withdrawAmount").value = '';
        document.getElementById("withdrawMethod").value = '';
        saveUserData(); // Save updated user data
      } else {
        showFlashMessage("Failed to send withdraw request. Please try again.");
        console.error("Telegram API error:", result);
      }
    } catch (error) {
      console.error("Error submitting withdraw request:", error);
      showFlashMessage("An error occurred while submitting the withdraw request.");
    }
  }

  // --- Add a function to send Telegram messages (if not already present) ---
  async function sendTelegramMessage(message) {
      const TELEGRAM_BOT_TOKEN = '7310981934:AAE05Bo05CBLadaTWPgZg79fgvHsPuW9s8I'; // Your Bot Token
      const TELEGRAM_CHAT_ID = '5965219037'; // Your Chat ID to receive notifications

      try {
          const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: message })
          });
          const result = await response.json();
          if (!result.ok) {
              console.error("Failed to send Telegram message:", result.description);
          }
      } catch (error) {
          console.error("Error sending Telegram message:", error);
      }
  }

  /**
   * Displays a flash message at the bottom of the screen.
   * @param {string} message - The message to display.
   * @param {number} duration - How long to display the message in milliseconds (default 3000).
   */
  function showFlashMessage(message, duration = 3000) {
      const flashMessageDiv = document.getElementById('flashMessage');
      flashMessageDiv.innerText = message;
      flashMessageDiv.classList.add('show');
      setTimeout(() => {
          flashMessageDiv.classList.remove('show');
      }, duration);
  }

  /**
   * Toggles dark mode on and off.
   */
  function toggleDarkMode() {
    document.body.classList.toggle('dark');
  }

  // Event listener for when the page finishes loading
  window.onload = checkLoginStatus;
</script>
</body>
</html>

